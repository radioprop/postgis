###########################################################
#
# Copyright (c) 2009 Sandro Santilli <strk@keybit.net>
# Copyright (c) 2015 Nathaniel Hunter Clay <clay.nathaniel@gmail.com>
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software Foundation,
# Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
#
#############################################################################

top_builddir = @top_builddir@
CC = @CC@
#LIBLWGEOM_LDFLAGS = ../../liblwgeom/.libs/liblwgeom.a
LIBLWGEOM_LDFLAGS = -L/usr/lib64 -llwgeom
LIBLWGEOM_CFLAGS = -I../../liblwgeom
LIBGDAL_CFLAGS = @LIBGDAL_CFLAGS@
LIBGDAL_LDFLAGS = @LIBGDAL_LDFLAGS@
GEOS_LDFLAGS = @GEOS_LDFLAGS@ -lgeos_c
PROJ_LDFLAGS = @PROJ_LDFLAGS@ -lproj
LDFLAGS = $(LIBGDAL_LDFLAGS) $(PROJ_LDFLAGS) $(GEOS_LDFLAGS) $(LIBLWGEOM_LDFLAGS)
CFLAGS = @CFLAGS@ @PICFLAGS@ @WARNFLAGS@ $(LIBLWGEOM_CFLAGS) $(LIBGDAL_CFLAGS) @PROJ_CPPFLAGS@ @GEOS_CPPFLAGS@
LIBTOOL = @LIBTOOL@
SHELL = @SHELL@
INSTALL = $(SHELL) ../install-sh
libdir = @libdir@

SOVER = @POSTGIS_MAJOR_VERSION@.@POSTGIS_MINOR_VERSION@

VERSION_INFO = 0:0:0

# Standalone RTCORE objects
RT_OBJS = \
	rt_util.o \
	rt_spatial_relationship.o \
	rt_mapalgebra.o \
	rt_geometry.o \
	rt_statistics.o \
	rt_pixel.o \
	rt_warp.o \
	rt_band.o \
	rt_raster.o \
	rt_serialize.o \
	rt_wkb.o \
	rt_context.o

RT_LIB = librtcore.la

RT_HEADERS = \
	rt_serialize.h \
	librtcore.h \
	librtcore_internal.h \
	../raster_config.h

LT_RT_OBJS = $(RT_OBJS:.o=.lo)

LT_OBJS = $(LT_RT_OBJS)

all: $(RT_LIB)

$(RT_OBJS): $(RT_HEADERS)

clean:
	rm -f $(RT_OBJS)
	rm -f $(LT_RT_OBJS)
	rm -f $(LT_OBJS)
	rm -f $(RT_LIB)

distclean: clean
	rm -f Makefile

install: install-librtcore

uninstall: uninstall-librtcore

install-librtcore: librtcore.la
	$(LIBTOOL) --mode=install $(INSTALL) librtcore.la "$(DESTDIR)$(libdir)/librtcore.la"
	$(LIBTOOL) -m 0644 rt_serialize.h "$(DESTDIR)$(includedir)/rt_serialize.h"
	$(LIBTOOL) -m 0644 librtcore.h "$(DESTDIR)$(includedir)/librtcore.h"
	$(LIBTOOL) -m 0644 librtcore_internal.h "$(DESTDIR)$(includedir)/librtcore_internal.h"

#librtcore.a: $(RT_OBJS)
#	$(AR) $(RT_LIB) $(RT_OBJS)

librtcore.la: $(LT_RT_OBJS)
	$(LIBTOOL) --tag=CC --mode=link $(CC) -rpath $(libdir) $(LT_OBJS) \
		-release $(SOVER) -version-info $(VERSION_INFO) $(LDFLAGS) -o $@
$(LT_RT_OBJS): %.lo : %.c
	$(LIBTOOL) --mode=compile $(CC) $(CFLAGS) -c -o $@ $<
